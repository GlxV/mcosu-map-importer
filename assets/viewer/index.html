<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Beatmap Preview</title>
  <link rel="stylesheet" crossorigin href="./assets/index.css" />
</head>
<body>
  <script type="module" crossorigin src="./assets/index.js"></script>
  <script>
    (async () => {
      const params = new URLSearchParams(window.location.search);
      const map = params.get("map");
      const name = params.get("title") || "beatmap.osz";
      if (!map) return;
      const wait = (ms) => new Promise((resolve) => setTimeout(resolve, ms));
      try {
        const res = await fetch(map);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const blob = await res.blob();
        await wait(200);
        const file = new File([blob], name, { type: "application/octet-stream" });
        const transfer = new DataTransfer();
        transfer.items.add(file);
        const evt = new DragEvent("drop", { dataTransfer: transfer });
        window.dispatchEvent(evt);
        const loading = document.querySelector("#loadingText");
        if (loading) {
          loading.textContent = "Carregando beatmap local";
        }
      } catch (err) {
        console.error(err);
        const warn = document.createElement("div");
        warn.textContent = `Falha ao carregar preview: ${err}`;
        warn.style.position = "fixed";
        warn.style.top = "10px";
        warn.style.right = "10px";
        warn.style.padding = "10px 14px";
        warn.style.background = "#2b2b2b";
        warn.style.color = "#f2f2f2";
        warn.style.border = "1px solid #444";
        warn.style.borderRadius = "8px";
        warn.style.zIndex = "9999";
        document.body.appendChild(warn);
      }
    })();
  </script>
</body>
</html>
